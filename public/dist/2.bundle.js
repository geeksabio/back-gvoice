(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{107:function(t,e,i){"use strict";(function(t){var e=i(108),n=t.OfflineAudioContext||t.webkitOfflineAudioContext;if(n){var s=new Uint32Array([1179011410,56,1163280727,544501094,16,65537,44100,88200,1048578,1635017060,20,0,0,0,0,0]).buffer;if(!new n(1,128,44100).decodeAudioData(s,function(){},function(){})){var a=e.prototype.decodeAudioData;e.prototype.decodeAudioData=function(t,e,i){var n=this,s=new Promise(function(e,i){return a.call(n,t,e,i)});return s.then(e,i),s},e.prototype.decodeAudioData.original=a}}}).call(this,i(38))},108:function(t,e,i){(function(e){var i=e.AudioContext||e.webkitAudioContext,n=e.OfflineAudioContext||e.webkitOfflineAudioContext,s=e.BaseAudioContext||n&&Object.getPrototypeOf(n);t.exports="function"==typeof s&&s.prototype?s:i}).call(this,i(38))},114:function(t,e,i){},137:function(t,e,i){"use strict";i.r(e);var n=i(2),s=i(0),a=i(11),o=i(15),l=i(25),c=i(3),r=function(t,e,i,n){return new(i||(i=Promise))(function(s,a){function o(t){try{c(n.next(t))}catch(t){a(t)}}function l(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(o,l)}c((n=n.apply(t,e||[])).next())})};i(107);class u{constructor(){const t=window.AudioContext||window.webkitAudioContext;this.audioCtx=new t,this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=1,this.gainNode.connect(this.audioCtx.destination)}play(t){return r(this,void 0,void 0,function*(){const e=yield(yield fetch(t)).arrayBuffer(),i=yield this.audioCtx.decodeAudioData(e),n=i.getChannelData(0);for(var s=Math.floor(.05*i.sampleRate),a=[],o=0,l=0;l<n.length;l++)o+=Math.pow(n[l],2),l%s==0&&(o=Math.sqrt(o/s),a.push(o),o=0);a.sort(function(t,e){return t-e});var c=1/a[Math.floor(.95*a.length)];c=Math.max(c,.02),c=Math.min(c,100),c/=10,this.gainNode.gain.value=c,this.playBuf(i)})}playBuf(t){this.bufSource&&this.bufSource.stop(),this.bufSource=this.audioCtx.createBufferSource(),this.bufSource.buffer=t,this.bufSource.connect(this.gainNode),this.bufSource.onended=this.onended,this.bufSource.start()}stop(){this.bufSource.stop()}close(){this.audioCtx.close()}}var d=i(5),h=i(6),p=i(106),y=i(92),m=i(103),f=(i(114),function(t,e,i,n){return new(i||(i=Promise))(function(s,a){function o(t){try{c(n.next(t))}catch(t){a(t)}}function l(t){try{c(n.throw(t))}catch(t){a(t)}}function c(t){t.done?s(t.value):new i(function(e){e(t.value)}).then(o,l)}c((n=n.apply(t,e||[])).next())})}),v=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(t);s<n.length;s++)e.indexOf(n[s])<0&&(i[n[s]]=t[n[s]])}return i};const g=3e3,b=t=>{var{type:e}=t,i=v(t,["type"]);return s.createElement("button",Object.assign({type:"button",className:["vote-button",e].join(" ")},i),"yes"===e&&s.createElement(d.H,null),"no"===e&&s.createElement(d.G,null),s.createElement(n.Localized,{id:"vote-"+e},s.createElement("span",null)))},S={clips:[],hasPlayed:!1,hasPlayedSome:!1,isPlaying:!1,isSubmitted:!1};const P={removeClip:l.a.actions.remove,vote:l.a.actions.vote};e.default=Object(a.b)(t=>{const{clips:e,isLoading:i}=l.a.selectors.localeClips(t);return{clips:e,isLoading:i,locale:t.locale}},P)(class extends s.Component{constructor(){super(...arguments),this.audioPlayer=new u,this.state=S,this.play=(()=>f(this,void 0,void 0,function*(){this.state.isPlaying?this.stop():(this.audioPlayer.onended=this.hasPlayed,yield this.audioPlayer.play(this.state.clips[this.getClipIndex()].audioSrc),this.setState({isPlaying:!0}),clearInterval(this.playedSomeInterval),this.playedSomeInterval=setInterval(()=>this.setState({hasPlayedSome:!0}),g))})),this.stop=(()=>{this.audioPlayer.stop(),clearInterval(this.playedSomeInterval),this.setState({isPlaying:!1})}),this.hasPlayed=(()=>{this.setState({hasPlayed:!0,isPlaying:!1}),Object(o.d)("listen",this.props.locale)}),this.vote=(t=>{const{clips:e}=this.state,i=this.getClipIndex();clearInterval(this.playedSomeInterval),this.props.vote(t,this.state.clips[this.getClipIndex()].id),this.setState({hasPlayed:!1,hasPlayedSome:!1,isPlaying:!1,isSubmitted:i===p.a-1,clips:e.map((e,n)=>n===i?Object.assign({},e,{isValid:t}):e)})}),this.voteYes=(()=>{this.state.hasPlayed&&(this.vote(!0),Object(o.d)("vote-yes",this.props.locale))}),this.voteNo=(()=>{const{hasPlayed:t,hasPlayedSome:e}=this.state;(t||e)&&(this.vote(!1),Object(o.d)("vote-no",this.props.locale))}),this.handleSkip=(()=>{const{removeClip:t}=this.props,{clips:e}=this.state;this.stop(),t(e[this.getClipIndex()].id),this.setState({clips:e.map((t,e)=>this.getClipIndex()===e?Object.assign({},this.props.clips.slice(p.a)[0],{isValid:null}):t)})}),this.reset=(()=>this.setState(S))}static getDerivedStateFromProps(t,e){return e.clips.length>0?null:t.clips.length>0?{clips:t.clips.slice(0,p.a).map(t=>Object.assign({},t,{isValid:null}))}:null}componentWillUnmount(){clearInterval(this.playedSomeInterval),this.audioPlayer.close()}getClipIndex(){return this.state.clips.findIndex(t=>null===t.isValid)}render(){const{clips:t,hasPlayed:e,hasPlayedSome:i,isPlaying:a,isSubmitted:o}=this.state,l=this.getClipIndex(),r=t[l];return s.createElement(s.Fragment,null,s.createElement(p.b,{activeIndex:l,errorContent:!this.props.isLoading&&0===t.length&&s.createElement("div",{className:"empty-container"},s.createElement("div",{className:"error-card card-dimensions"},s.createElement(n.Localized,{id:"nothing-to-validate"},s.createElement("span",null)),s.createElement(h.i,{rounded:!0,to:c.a.SPEAK,className:"record-instead"},s.createElement(d.u,null)," ",s.createElement(n.Localized,{id:"record-button-label"},s.createElement("span",null))))),instruction:t=>r&&!a&&!i&&!e&&s.createElement(n.Localized,Object.assign({id:l===p.a-1?"listen-last-time-instruction":["listen-instruction","listen-again-instruction","listen-3rd-time-instruction"][l]||"listen-again-instruction",playIcon:s.createElement(d.v,null)},t)),isPlaying:a,isSubmitted:o,onReset:this.reset,onSkip:this.handleSkip,primaryButtons:s.createElement(s.Fragment,null,s.createElement(b,{type:"yes",onClick:this.voteYes,disabled:!e}),s.createElement(y.a,{isPlaying:a,onClick:this.play}),s.createElement(b,{type:"no",onClick:this.voteNo,disabled:!e&&!i})),pills:t.map(({isValid:t},e)=>i=>{const n=null!==t,a=l===e;return s.createElement(m.a,Object.assign({className:n?t?"valid":"invalid":"",onClick:null,status:a?"active":n?"done":"pending"},i),a?s.createElement(d.L,null):n?t?s.createElement(d.d,null):s.createElement(d.i,null):null)}),sentences:t.map(t=>t.sentence),shortcuts:[{key:"shortcut-play-toggle",label:"shortcut-play-toggle-label",action:this.play},{key:"shortcut-vote-yes",label:"vote-yes",action:this.voteYes},{key:"shortcut-vote-no",label:"vote-no",action:this.voteNo}],type:"listen"}))}})}}]);